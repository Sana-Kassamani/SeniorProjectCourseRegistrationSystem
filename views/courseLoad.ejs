<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timetable</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="main.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Animation CSS -->
  <style>
    table {
      animation: slideInUp 1s ease-out;
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th,
    td {
      padding: 12px;
      text-align: center;
      border: 1px solid #ddd;
    }

    th {
      background-color: #343a40;
      color: white;
    }

    tbody tr:hover {
      background-color: #f1f1f1;
      transition: background-color 0.3s ease;
    }

    td {
      position: relative;
      transition: transform 0.2s ease;
    }

    td:hover {
      transform: scale(1.05);
    }

    /*td::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.1);
      opacity: 0;
      transition: opacity 0.3s ease;
    }*/

    td:hover::before {
      opacity: 1;
    }

    .chart-container {
      max-width: 600px;
      margin: auto;
    }
  </style>
</head>

<body>
  <!-- Your navigation and sidebar includes -->
  <%- include ('NavBar.ejs') -%>
    <div id="wrapper">
      <%- include ('SideBar.ejs') -%>

        <div id="page-content-wrapper">
          <div id="Load">
            <h2 class="text-white">Timetable</h2>

            <div class="mb-3">
              <form action="/courseLoad" method="POST">
                <label for="semesterSelect" class="form-label">Select Semester:</label>
                <select id="semesterSelect" class="form-select" name="value">
                  <option value="Fall 2024">Fall 2024</option>
                  <option value="Spring 2024">Spring 2024</option>
                  <option value="Summer 2024">Summer 2024</option>
                  <option value="Fall 2023">Fall 2023</option>
                  <option value="Spring 2023">Spring 2023</option>
                  <option value="Summer 2023">Summer 2023</option>
                </select>
                <button type="submit" class="btn btn-primary mt-3">Submit</button>
              </form>
            </div>
            <div class="table-responsive">
              <table class="table table-bordered border-dark">
                <thead class="table-dark">
                  <tr>
                    <th></th>
                    <th>Monday</th>
                    <th>Tuesday</th>
                    <th>Wednesday</th>
                    <th>Thursday</th>
                    <th>Friday</th>
                  </tr>
                </thead>
                <tbody>
                  <% const daysOfWeek=['Monday', 'Tuesday' , 'Wednesday' , 'Thursday' , 'Friday' ]; %>
                    <% const timeSlots=[...new Set(data.map(course=> course.Time))].sort((a, b) => (a > b ? -1 : 1)); %>


                      <% timeSlots.forEach(slot=> { %>
                        <tr>
                          <td>
                            <%= slot %>
                          </td>
                          <% daysOfWeek.forEach(day=> { %>
                            <% const coursesForSlot=data.filter(course=> course.Days.includes(day) && course.Time ===
                              slot); %>
                              <td>
                                <% if (coursesForSlot.length> 0) { %>
                                  <% coursesForSlot.forEach(course=> { %>
                                    <div>
                                      <strong>
                                        <%= course.CourseCode %>
                                      </strong><br>
                                      <%= course.FName %>
                                        <%= course.LName %><br>
                                          <%= course.Room %>
                                    </div>
                                    <% }); %>
                                      <% } else { %>
                                        <div>No course scheduled</div>
                                        <% } %>
                              </td>
                              <% }); %>
                        </tr>
                        <% }); %>
                </tbody>
              </table>
            </div>
          </div>

          <div class="container mt-5 chart-container">
            <h2 class="text-white">Courses Chart</h2>
            <canvas id="courseLoadChart"></canvas>
          </div>

          <button class="btn btn-primary mt-4" onclick="showGpaCalculation()" style="float: right;">Calculate GPA</button>

          <!-- GPA Calculation Section -->
          <div id="gpa-calculation" class="mt-5" style="display: none;">
            <h3 class="text-white">Calculate your GPA for this semester</h3>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Course</th>
                    <th>Credits</th>
                    <th>Grade</th>
                  </tr>
                </thead>
                <tbody id="gpa-calculation-body">
                  <% const semesters={ "Spring 2024" : data }; %>
                    <% const latestSemester=Object.keys(semesters).sort().pop(); %>
                      <% semesters[latestSemester].forEach(function(course) { %>
                        <tr>
                          <td>
                            <%= course.CourseCode %>
                          </td>
                          <td>
                            <%= course.Credits %>
                          </td>
                          <td>
                            <select class="form-select grade" required>
                              <option value="" selected disabled>Select grade</option>
                              <option value="A+">A+</option>
                              <option value="A">A</option>
                              <option value="A-">A-</option>
                              <option value="B+">B+</option>
                              <option value="B">B</option>
                              <option value="B-">B-</option>
                              <option value="C+">C+</option>
                              <option value="C">C</option>
                              <option value="C-">C-</option>
                              <option value="D+">D+</option>
                              <option value="D">D</option>
                              <option value="D-">D-</option>
                              <option value="F">F</option>
                            </select>
                          </td>
                        </tr>
                        <% }); %>
                </tbody>
              </table>
              <button class="btn btn-primary" onclick="calculateGPA()">Calculate</button>
              <h4 class="mt-3 text-white">Semester GPA: <span id="calculated-gpa">N/A</span></h4>
            </div>
          </div>
        </div>

    </div>
    </div>

    <script src="sidebar.js"></script>
    <script>


      // Chart initialization code
      const courseData = JSON.parse('<%- JSON.stringify(data) %>');
      const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
      const daysInDb=['M', 'T', 'W', 'TH', 'F']
    const courseCount = daysInDb.map(day => courseData.filter(course => course.Days.includes(day)).length);

      const ctx = document.getElementById('courseLoadChart').getContext('2d');
      const courseLoadChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: daysOfWeek,
          datasets: [{
            label: 'Number of Courses',
            data: courseCount,
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 2
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      //new gpa script
      function showGpaCalculation() {
        document.getElementById('gpa-calculation').style.display = 'block';
      }

      function calculateGPA() {
        // Initialize variables for GPA calculation
        let totalCredits = 0;
        let totalQualityPoints = 0;


        // Loop through each row in the GPA calculation table
        $('#gpa-calculation-body tr').each(function () {
          const credits = parseFloat($(this).find('td:nth-child(2)').text());
          const grade = $(this).find('.grade').val();

          let gradePoint;
          switch (grade.toUpperCase()) {
            case 'A+':
              gradePoint = 4.0;
              break;
            case 'A':
              gradePoint = 4.0;
              break;
            case 'A-':
              gradePoint = 3.7;
              break;
            case 'B+':
              gradePoint = 3.3;
              break;
            case 'B':
              gradePoint = 3.0;
              break;
            case 'B-':
              gradePoint = 2.7;
              break;
            case 'C+':
              gradePoint = 2.3;
              break;
            case 'C':
              gradePoint = 2.0;
              break;
            case 'C-':
              gradePoint = 1.7;
              break;
            case 'D+':
              gradePoint = 1.3;
              break;
            case 'D':
              gradePoint = 1.0;
              break;
            case 'D-':
              gradePoint = 0.7;
              break;
            case 'F':
              gradePoint = 0.0;
              break;
            default:
              gradePoint = 0.0; // Handle other grades as needed
              break;
          }

          // Calculate quality points for this course
          const qualityPoints = credits * gradePoint;

          // Accumulate total credits and quality points
          totalCredits += credits;
          totalQualityPoints += qualityPoints;
        });

        // Calculate GPA
        const gpa = totalQualityPoints / totalCredits;

        // Display calculated GPA
        $('#calculated-gpa').text(gpa.toFixed(2));
      }

    </script>
</body>

</html>